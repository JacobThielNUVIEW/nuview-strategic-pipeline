<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>NUVIEW Strategic Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --nuview-red: #EE3338; --nuview-navy: #001F3F; --nuview-blue: #007BFF; --dark: #343a40; }
        body { font-family: 'Inter', sans-serif; background: #f8f9fa; color: var(--dark); margin: 0; padding: 0; }
        .header { background: linear-gradient(135deg, var(--nuview-navy), var(--nuview-blue)); color: white; padding: 2.5rem 0; text-align: center; border-bottom: 5px solid var(--nuview-red); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .sidebar { position: fixed; left: 0; top: 0; height: 100%; width: 260px; background: #fff; box-shadow: 2px 0 8px rgba(0,0,0,0.04); z-index: 100; border-right: 2px solid var(--nuview-blue); padding-top: 2rem; overflow-y: auto; }
        .sidebar a { color: var(--nuview-blue); text-decoration: none; display: block; padding: 0.5rem 1rem; margin-bottom: 5px; transition:0.2s; }
        .sidebar a.active, .sidebar a:hover { background: #e6effc; color: var(--nuview-navy); border-left: 4px solid var(--nuview-red); }
        .main-content { margin-left: 260px; padding: 30px; min-height: 100vh; }
        .section { background: white; border-radius: 16px; padding: 1.8rem; margin: 1.5rem 0; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .section h2 { color: var(--nuview-blue); border-bottom: 3px solid var(--nuview-red); padding-bottom: 0.5rem; margin-bottom: 1rem; font-size: 1.6rem; }
        .heatmap-table th { background: var(--nuview-navy); color: white; }
        .hot { background: #ffb7a1; font-weight: 700; }
        .warmer { background: #ffe7c7; }
        .matrix-cell { text-align: center; padding: 1.5rem; font-size: 1.1rem; border: 2px solid #ddd; }
        .matrix-cell.empty { background: #f8f9fa; color: #999; }
        .matrix-cell.low { background: #d4edda; color: #155724; }
        .matrix-cell.medium { background: #fff3cd; color: #856404; }
        .matrix-cell.high { background: #f8d7da; color: #721c24; }
        .matrix-cell.critical { background: #EE3338; color: white; font-weight: bold; }
        .search-container { padding: 1rem; background: white; margin: 1rem 0; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .search-input { width: 100%; padding: 0.75rem; border: 2px solid var(--nuview-blue); border-radius: 8px; font-size: 1rem; }
        .program-card { background: white; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; border-left: 4px solid var(--nuview-blue); box-shadow: 0 2px 6px rgba(0,0,0,0.06); transition: all 0.2s; }
        .program-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.12); transform: translateY(-2px); }
        .program-card.hidden { display: none; }
        .urgency-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem; font-weight: 600; }
        .urgency-urgent { background: var(--nuview-red); color: white; }
        .urgency-near { background: #ffc107; color: #333; }
        .urgency-future { background: #28a745; color: white; }
    </style>
</head>
<body>

<nav class="sidebar">
    <h3 style="padding-left:1rem; color:var(--nuview-navy); font-weight:800;">NUVIEW INTEL</h3>
    <a href="#overview" class="active"><i class="bi bi-house-door"></i> Overview</a>
    <a href="#funding"><i class="bi bi-currency-dollar"></i> Funding</a>
    <a href="#lidar"><i class="bi bi-radar"></i> LiDAR</a>
    <a href="#space-systems"><i class="bi bi-rocket-takeoff"></i> Space Systems</a>
    <a href="#platform"><i class="bi bi-server"></i> Platform</a>
    <a href="pipeline.html"><i class="bi bi-funnel"></i> Pipeline Dashboard</a>
    <a href="global-tracker.html"><i class="bi bi-globe"></i> Global Tracker</a>
</nav>

<main class="main-content">
    <header class="header">
        <h1>NUVIEW Strategic Dashboard</h1>
        <p style="opacity:0.9; font-size:1.1rem;">Global LiDAR Pipeline Tracker â€¢ 2025â€“2027 â€¢ DaaS Disruption</p>
    </header>

    <!-- Global Search -->
    <div class="search-container">
        <input 
            type="text" 
            id="globalSearch" 
            class="search-input" 
            placeholder="ðŸ” Search programs by title, agency, category, or action..."
        >
    </div>

    <div id="overview" class="section">
        <h2><i class="bi bi-house-door"></i> Executive Overview</h2>
        <p>The global LiDAR market is projected to reach <strong id="market-val">$14.13B</strong> by 2034 (CAGR <span id="market-cagr">19.43%</span>). NUVIEW dominates DaaS with space-based data.</p>
        <div class="row">
            <div class="col-md-3">
                <div class="card text-center">
                    <h3 id="total-programs">0</h3>
                    <p class="text-muted">Total Programs</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <h3 id="total-value">$0</h3>
                    <p class="text-muted">Total Value</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <h3 id="urgent-programs">0</h3>
                    <p class="text-muted">Urgent Actions</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <h3 id="last-updated">Loading...</h3>
                    <p class="text-muted">Last Updated</p>
                </div>
            </div>
        </div>
    </div>

    <div id="funding" class="section">
        <h2><i class="bi bi-currency-dollar"></i> Funding Opportunities</h2>
        <div id="funding-programs">
            <p>Loading funding programs...</p>
        </div>
    </div>

    <div id="lidar" class="section">
        <h2><i class="bi bi-radar"></i> LiDAR Programs</h2>
        <div id="lidar-programs">
            <p>Loading LiDAR programs...</p>
        </div>
    </div>

    <div id="space-systems" class="section">
        <h2><i class="bi bi-rocket-takeoff"></i> Space Systems</h2>
        <div id="space-systems-programs">
            <p>Loading space systems programs...</p>
        </div>
    </div>

    <div id="platform" class="section">
        <h2><i class="bi bi-server"></i> Platform Initiatives</h2>
        <div id="platform-programs">
            <p>Loading platform programs...</p>
        </div>
    </div>
</main>

<script>
// Global data
let programsData = null;

// Format currency
function formatCurrency(amount) {
    if (!amount) return '$0';
    if (amount >= 1000000000) {
        return '$' + (amount / 1000000000).toFixed(2) + 'B';
    } else if (amount >= 1000000) {
        return '$' + (amount / 1000000).toFixed(1) + 'M';
    } else if (amount >= 1000) {
        return '$' + (amount / 1000).toFixed(0) + 'K';
    }
    return '$' + amount.toFixed(0);
}

// Get urgency badge
function getUrgencyBadge(urgency) {
    const badges = {
        'urgent': '<span class="urgency-badge urgency-urgent">URGENT</span>',
        'near': '<span class="urgency-badge urgency-near">NEAR</span>',
        'future': '<span class="urgency-badge urgency-future">FUTURE</span>'
    };
    return badges[urgency || 'future'] || badges['future'];
}

// Create program card
function createProgramCard(program) {
    const card = document.createElement('div');
    card.className = 'program-card';
    card.setAttribute('data-searchable', `${program.title || ''} ${program.agency || ''} ${program.category || ''} ${program.nextAction || ''}`.toLowerCase());
    
    const title = program.title || 'Untitled Program';
    const agency = program.agency || 'N/A';
    const value = formatCurrency(program.valueUSD || 0);
    const deadline = program.deadline || 'TBD';
    const daysUntil = program.daysUntil !== undefined ? program.daysUntil : 'N/A';
    const urgency = program.urgency || 'future';
    const nextAction = program.nextAction || 'No action specified';
    const description = program.description || 'No description available';
    const link = program.link || '#';
    
    card.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
            <div>
                <h5 style="margin: 0; color: var(--nuview-navy);">${title}</h5>
                <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">${description}</p>
            </div>
            ${getUrgencyBadge(urgency)}
        </div>
        <div class="row" style="margin-top: 1rem; font-size: 0.9rem;">
            <div class="col-md-3">
                <strong>Agency:</strong> ${agency}
            </div>
            <div class="col-md-3">
                <strong>Value:</strong> ${value}
            </div>
            <div class="col-md-3">
                <strong>Deadline:</strong> ${deadline} (${daysUntil} days)
            </div>
            <div class="col-md-3">
                <strong>Link:</strong> <a href="${link}" target="_blank" style="color: var(--nuview-blue);">View</a>
            </div>
        </div>
        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #eee;">
            <strong style="color: var(--nuview-red);">Next Action:</strong> ${nextAction}
        </div>
    `;
    
    return card;
}

// Render programs in a section
function renderPrograms(programs, containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    container.innerHTML = '';
    
    if (!programs || programs.length === 0) {
        container.innerHTML = '<p style="color: #999;">No programs in this category.</p>';
        return;
    }
    
    programs.forEach(program => {
        container.appendChild(createProgramCard(program));
    });
}

// Update overview statistics
function updateOverview() {
    if (!programsData || !programsData.programs) return;
    
    const allPrograms = [
        ...(programsData.programs.funding || []),
        ...(programsData.programs.lidar || []),
        ...(programsData.programs.spaceSystems || []),
        ...(programsData.programs.platform || [])
    ];
    
    // Remove duplicates by ID
    const uniquePrograms = Array.from(new Map(allPrograms.map(p => [p.id, p])).values());
    
    const totalValue = uniquePrograms.reduce((sum, p) => sum + (p.valueUSD || 0), 0);
    const urgentCount = uniquePrograms.filter(p => p.urgency === 'urgent').length;
    
    document.getElementById('total-programs').textContent = uniquePrograms.length;
    document.getElementById('total-value').textContent = formatCurrency(totalValue);
    document.getElementById('urgent-programs').textContent = urgentCount;
    
    if (programsData.meta && programsData.meta.updated) {
        const date = new Date(programsData.meta.updated);
        document.getElementById('last-updated').textContent = date.toLocaleDateString();
    }
}

// Global search functionality - FIX: use e.target.value instead of this.value
function setupGlobalSearch() {
    const searchInput = document.getElementById('globalSearch');
    if (!searchInput) return;
    
    searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase(); // FIXED: use e.target.value
        const allCards = document.querySelectorAll('.program-card');
        
        allCards.forEach(card => {
            const searchableText = card.getAttribute('data-searchable') || '';
            if (searchableText.includes(searchTerm)) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    });
}

// Load programs data
async function loadPrograms() {
    try {
        const response = await fetch('../data/processed/programs.json');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        programsData = await response.json();
        
        // Render all sections with robust handling for missing data
        renderPrograms(programsData.programs?.funding || [], 'funding-programs');
        renderPrograms(programsData.programs?.lidar || [], 'lidar-programs');
        renderPrograms(programsData.programs?.spaceSystems || [], 'space-systems-programs');
        renderPrograms(programsData.programs?.platform || [], 'platform-programs');
        
        // Update overview
        updateOverview();
        
        // Setup global search
        setupGlobalSearch();
        
    } catch (error) {
        console.error('Error loading programs data:', error);
        const containers = ['funding-programs', 'lidar-programs', 'space-systems-programs', 'platform-programs'];
        containers.forEach(id => {
            const container = document.getElementById(id);
            if (container) {
                container.innerHTML = '<p style="color: var(--nuview-red);">Error loading data. Please check the console for details.</p>';
            }
        });
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    loadPrograms();
});
</script>
</body>
</html>
