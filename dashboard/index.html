<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUVIEW Mastered Sales Sheet</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --nuview-red: #EE3338; --nuview-navy: #001F3F; --nuview-blue: #007BFF; --dark: #343a40; }
        body { font-family: 'Inter', sans-serif; background: #f8f9fa; color: var(--dark); margin: 0; padding: 0; }
        .header { background: linear-gradient(135deg, var(--nuview-navy), var(--nuview-blue)); color: white; padding: 2.5rem 0; text-align: center; border-bottom: 5px solid var(--nuview-red); box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .sidebar { position: fixed; left: 0; top: 0; height: 100%; width: 260px; background: #fff; box-shadow: 2px 0 8px rgba(0,0,0,0.04); z-index: 100; border-right: 2px solid var(--nuview-blue); padding-top: 2rem; overflow-y: auto; }
        .sidebar a { color: var(--nuview-blue); text-decoration: none; display: block; padding: 0.5rem 1rem; margin-bottom: 5px; transition:0.2s; }
        .sidebar a.active, .sidebar a:hover { background: #e6effc; color: var(--nuview-navy); border-left: 4px solid var(--nuview-red); }
        .main-content { margin-left: 260px; padding: 30px; min-height: 100vh; }
        .section { background: white; border-radius: 16px; padding: 1.8rem; margin: 1.5rem 0; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .section h2 { color: var(--nuview-blue); border-bottom: 3px solid var(--nuview-red); padding-bottom: 0.5rem; margin-bottom: 1rem; font-size: 1.6rem; }
        .heatmap-table th { background: var(--nuview-navy); color: white; }
        .hot { background: #ffb7a1; font-weight: 700; }
        .warmer { background: #ffe7c7; }
        .matrix-cell { text-align: center; padding: 1.5rem; font-size: 1.1rem; border: 2px solid #ddd; }
        .matrix-cell.empty { background: #f8f9fa; color: #999; }
        .matrix-cell.low { background: #d4edda; color: #155724; }
        .matrix-cell.medium { background: #fff3cd; color: #856404; }
        .matrix-cell.high { background: #f8d7da; color: #721c24; }
        .matrix-cell.critical { background: #EE3338; color: white; font-weight: bold; }
    </style>
</head>
<body>

<nav class="sidebar">
    <h3 style="padding-left:1rem; color:var(--nuview-navy); font-weight:800;">NUVIEW INTEL</h3>
    <a href="#overview" class="active"><i class="bi bi-star"></i> Exec Overview</a>
    <a href="pipeline.html"><i class="bi bi-funnel"></i> Pipeline Dashboard</a>
    <a href="#heatmap"><i class="bi bi-graph-up"></i> Market Forecast</a>
    <a href="#matrix"><i class="bi bi-grid-3x3"></i> Priority Matrix</a>
    <a href="#charts"><i class="bi bi-pie-chart"></i> Analytics</a>
    <a href="#schedule"><i class="bi bi-list-task"></i> Action Schedule</a>
</nav>

<main class="main-content">
    <header class="header">
        <h1>NUVIEW Mastered Sales Sheet</h1>
        <p style="opacity:0.9; font-size:1.1rem;">Global LiDAR Pipeline Tracker • 2025–2027 • DaaS Disruption</p>
    </header>

    <div id="overview" class="section">
        <h2><i class="bi bi-star"></i> Executive Overview</h2>
        <p>The global LiDAR market is projected to reach <strong id="market-val">$14.13B</strong> by 2034 (CAGR <span id="market-cagr">19.43%</span>). NUVIEW dominates DaaS with space-based data.</p>
        <ul>
            <li><strong>Market:</strong> $3.41B (2026) → $14.13B (2034)</li>
            <li><strong>Goal:</strong> $50M revenue by Q4 2026</li>
        </ul>
    </div>

    <div id="heatmap" class="section">
        <h2><i class="bi bi-graph-up"></i> Global LiDAR Market Forecast</h2>
        <table class="table table-bordered heatmap-table">
            <thead><tr><th>Region</th><th>2026 Spend</th><th>2034 Forecast</th><th>CAGR</th><th>Status</th></tr></thead>
            <tbody>
                <tr class="hot"><td>North America</td><td>$1.3B</td><td>$5.6B</td><td><strong>22.5%</strong></td><td>Fastest Growing</td></tr>
                <tr class="warmer"><td>Asia-Pacific</td><td>$1.4B</td><td>$5.8B</td><td>19.8%</td><td>Largest Share</td></tr>
                <tr class="warmer"><td>Europe</td><td>$0.5B</td><td>$1.8B</td><td>18.5%</td><td>Structured Grants</td></tr>
            </tbody>
        </table>
    </div>

    <div id="matrix" class="section">
        <h2><i class="bi bi-grid-3x3"></i> Priority Matrix (Live Data)</h2>
        <p>Opportunities prioritized by urgency and category. Values represent total funding ($USD).</p>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Category</th>
                    <th style="background: #EE3338; color: white;">URGENT</th>
                    <th style="background: #ffc107; color: #333;">SOON</th>
                    <th style="background: #28a745; color: white;">LATER</th>
                </tr>
            </thead>
            <tbody id="matrix-body">
                <tr><td colspan="4" style="text-align: center;">Loading matrix data...</td></tr>
            </tbody>
        </table>
    </div>

    <div id="charts" class="section">
        <h2><i class="bi bi-pie-chart"></i> Analytics Dashboard</h2>
        <div class="row">
            <div class="col-md-6">
                <h5>Opportunities by Category</h5>
                <canvas id="categoryChart" height="200"></canvas>
            </div>
            <div class="col-md-6">
                <h5>Funding by Urgency</h5>
                <canvas id="urgencyChart" height="200"></canvas>
            </div>
        </div>
    </div>

    <div id="schedule" class="section">
        <h2><i class="bi bi-list-task"></i> Critical Actions (Live Feed)</h2>
        <ul id="action-list"><li>Loading live intelligence...</li></ul>
    </div>
</main>

<script>
// Global chart instances
let categoryChart = null;
let urgencyChart = null;

async function loadPriorityMatrix() {
    try {
        const res = await fetch('../data/priority_matrix.csv');
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const text = await res.text();
        
        const lines = text.trim().split('\n');
        const headers = lines[0].split(',');
        const matrixBody = document.getElementById('matrix-body');
        matrixBody.innerHTML = '';
        
        for (let i = 1; i < lines.length; i++) {
            const values = lines[i].split(',');
            const row = document.createElement('tr');
            
            for (let j = 0; j < values.length; j++) {
                const cell = document.createElement(j === 0 ? 'th' : 'td');
                const value = values[j];
                
                if (j === 0) {
                    cell.textContent = value;
                    cell.style.background = 'var(--nuview-navy)';
                    cell.style.color = 'white';
                } else {
                    const amount = parseInt(value);
                    if (amount === 0) {
                        cell.textContent = '—';
                        cell.className = 'matrix-cell empty';
                    } else {
                        cell.textContent = '$' + (amount / 1000000).toFixed(1) + 'M';
                        cell.className = 'matrix-cell ' + 
                            (amount >= 200000000 ? 'critical' : 
                             amount >= 50000000 ? 'high' : 
                             amount >= 10000000 ? 'medium' : 'low');
                    }
                }
                row.appendChild(cell);
            }
            matrixBody.appendChild(row);
        }
    } catch(e) {
        console.error('Error loading matrix:', e);
        document.getElementById('matrix-body').innerHTML = 
            '<tr><td colspan="4" style="color:#EE3338;">Error loading matrix data</td></tr>';
    }
}

async function createCharts(opportunities) {
    // Destroy existing charts if they exist
    if (categoryChart) categoryChart.destroy();
    if (urgencyChart) urgencyChart.destroy();
    
    // Category breakdown
    const categories = {};
    const urgencies = { urgent: 0, near: 0, future: 0 };
    
    opportunities.forEach(o => {
        const cat = o.pillar || 'Unknown';
        categories[cat] = (categories[cat] || 0) + 1;
        
        const urg = o.timeline?.urgency || 'future';
        urgencies[urg] = (urgencies[urg] || 0) + (o.funding?.amountUSD || 0);
    });
    
    // Category Chart
    const ctx1 = document.getElementById('categoryChart');
    if (ctx1) {
        categoryChart = new Chart(ctx1, {
            type: 'doughnut',
            data: {
                labels: Object.keys(categories),
                datasets: [{
                    data: Object.values(categories),
                    backgroundColor: ['#007BFF', '#28a745', '#ffc107', '#EE3338']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    }
    
    // Urgency Chart
    const ctx2 = document.getElementById('urgencyChart');
    if (ctx2) {
        urgencyChart = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: ['Urgent', 'Near', 'Future'],
                datasets: [{
                    label: 'Total Funding ($M)',
                    data: [
                        urgencies.urgent / 1000000,
                        urgencies.near / 1000000,
                        urgencies.future / 1000000
                    ],
                    backgroundColor: ['#EE3338', '#ffc107', '#28a745']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Funding (Millions USD)'
                        }
                    }
                }
            }
        });
    }
}

async function init() {
    try {
        const res = await fetch('../data/opportunities.json');
        if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
        }
        const json = await res.json();
        
        if (json.meta && json.meta.market_val) {
            document.getElementById('market-val').innerText = "$" + json.meta.market_val + "B";
        }
        if (json.meta && json.meta.cagr) {
            document.getElementById('market-cagr').innerText = json.meta.cagr + "%";
        }

        const list = document.getElementById('action-list');
        list.innerHTML = '';
        
        if (json.opportunities && json.opportunities.length > 0) {
            json.opportunities.forEach(o => {
                const li = document.createElement('li');
                li.style.marginBottom = "10px";
                li.innerHTML = `<span class="badge bg-primary">${o.pillar}</span> <strong>${o.deadline}:</strong> ${o.title} — <span style="color:#EE3338; font-weight:bold;">${o.next_action}</span>`;
                list.appendChild(li);
            });
            
            // Create charts with opportunity data
            await createCharts(json.opportunities);
        } else {
            list.innerHTML = '<li>No opportunities available.</li>';
        }
    } catch(e) { 
        console.error('Error loading data:', e);
        document.getElementById('action-list').innerHTML = '<li style="color:#EE3338;">Error loading data. Please check the console for details.</li>'; 
    }
    
    // Load priority matrix
    await loadPriorityMatrix();
}

init();
</script>
</body>
</html>
