<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>NUVIEW Strategic Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --nuview-red: #EE3338; 
            --nuview-navy: #001F3F; 
            --nuview-blue: #007BFF; 
            --nuview-white: #FFFFFF; 
            --dark: #1a1a1a; 
            --light-gray: #f8f9fa; 
            /* Header gradient overlay colors */
            --header-overlay-start: rgba(255, 255, 255, 0.95);
            --header-overlay-light: rgba(255, 255, 255, 0.85);
            --header-overlay-red: rgba(238, 51, 56, 0.08);
            --header-overlay-navy: rgba(0, 31, 63, 0.85);
            --header-overlay-dark: rgba(0, 0, 0, 0.9);
        }
        body { font-family: 'Inter', sans-serif; background: var(--light-gray); color: var(--dark); margin: 0; padding: 0; }
        .header { 
            background: linear-gradient(135deg, var(--nuview-white) 0%, #f5f5f5 25%, var(--nuview-navy) 60%, var(--dark) 100%); 
            color: var(--dark); 
            padding: 3.5rem 2rem 3rem; 
            text-align: center; 
            border-bottom: 6px solid var(--nuview-red); 
            box-shadow: 0 6px 24px rgba(238, 51, 56, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1); 
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                var(--header-overlay-start) 0%, 
                var(--header-overlay-light) 20%,
                var(--header-overlay-red) 40%,
                var(--header-overlay-navy) 70%,
                var(--header-overlay-dark) 100%
            );
            z-index: 1;
        }
        .header-content {
            position: relative;
            z-index: 2;
            max-width: 1200px;
            margin: 0 auto;
        }
        .header-logo {
            font-family: 'Inter', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            letter-spacing: 2px;
            margin-bottom: 1.25rem;
            text-transform: uppercase;
            color: var(--nuview-red); /* Fallback color for accessibility */
            background: linear-gradient(135deg, var(--nuview-red) 0%, var(--nuview-navy) 50%, var(--dark) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.1));
            line-height: 1.1;
        }
        @supports not (background-clip: text) {
            .header-logo {
                color: var(--nuview-red);
                -webkit-text-fill-color: var(--nuview-red);
            }
        }
        .header h1 {
            font-size: 2.75rem;
            font-weight: 700;
            margin: 0.75rem 0 1rem;
            color: var(--nuview-navy);
            letter-spacing: -0.5px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
            line-height: 1.3;
        }
        .header-subtitle {
            font-size: 1.25rem;
            font-weight: 500;
            opacity: 0.95;
            color: var(--nuview-navy);
            margin-top: 1rem;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
        }
        .sidebar { position: fixed; left: 0; top: 0; height: 100%; width: 260px; background: var(--nuview-white); box-shadow: 2px 0 12px rgba(238, 51, 56, 0.08), 2px 0 4px rgba(0, 0, 0, 0.04); z-index: 100; border-right: 3px solid var(--nuview-red); padding-top: 2rem; overflow-y: auto; }
        .sidebar h3 { padding-left: 1rem; color: var(--nuview-navy); font-weight: 800; font-size: 1.1rem; letter-spacing: 0.5px; margin-bottom: 1.5rem; }
        .sidebar a { color: var(--nuview-navy); text-decoration: none; display: block; padding: 0.75rem 1rem; margin-bottom: 0.25rem; transition: all 0.3s ease; font-weight: 500; }
        .sidebar a.active, .sidebar a:hover { background: linear-gradient(90deg, rgba(238, 51, 56, 0.1) 0%, rgba(238, 51, 56, 0.05) 100%); color: var(--nuview-red); border-left: 5px solid var(--nuview-red); padding-left: calc(1rem - 5px); }
        .main-content { margin-left: 260px; padding: 30px; min-height: 100vh; }
        .section { background: var(--nuview-white); border-radius: 16px; padding: 2rem; margin: 1.5rem 0; box-shadow: 0 4px 16px rgba(238, 51, 56, 0.06), 0 2px 8px rgba(0, 0, 0, 0.04); border-top: 3px solid var(--nuview-red); }
        .section h2 { color: var(--nuview-navy); border-bottom: 4px solid var(--nuview-red); padding-bottom: 0.75rem; margin-bottom: 1.5rem; font-size: 1.75rem; font-weight: 700; letter-spacing: -0.25px; }
        .heatmap-table th { background: var(--nuview-navy); color: white; }
        .hot { background: #ffb7a1; font-weight: 700; }
        .warmer { background: #ffe7c7; }
        .matrix-cell { text-align: center; padding: 1.5rem; font-size: 1.1rem; border: 2px solid #ddd; }
        .matrix-cell.empty { background: #f8f9fa; color: #999; }
        .matrix-cell.low { background: #d4edda; color: #155724; }
        .matrix-cell.medium { background: #fff3cd; color: #856404; }
        .matrix-cell.high { background: #f8d7da; color: #721c24; }
        .matrix-cell.critical { background: #EE3338; color: white; font-weight: bold; }
        .search-container { padding: 1.25rem; background: var(--nuview-white); margin: 1.5rem 0; border-radius: 12px; box-shadow: 0 3px 10px rgba(238, 51, 56, 0.08), 0 1px 4px rgba(0, 0, 0, 0.04); border: 2px solid rgba(238, 51, 56, 0.1); }
        .search-input { width: 100%; padding: 0.875rem; border: 2px solid var(--nuview-red); border-radius: 10px; font-size: 1.05rem; transition: all 0.3s ease; outline: none; }
        .search-input:focus { border-color: var(--nuview-navy); box-shadow: 0 0 0 3px rgba(238, 51, 56, 0.1); }
        .program-card { background: var(--nuview-white); border-radius: 10px; padding: 1.25rem; margin-bottom: 1rem; border-left: 5px solid var(--nuview-red); box-shadow: 0 3px 8px rgba(238, 51, 56, 0.06), 0 1px 3px rgba(0, 0, 0, 0.04); transition: all 0.3s ease; }
        .program-card:hover { box-shadow: 0 6px 16px rgba(238, 51, 56, 0.12), 0 2px 6px rgba(0, 0, 0, 0.08); transform: translateY(-3px); border-left-width: 6px; }
        .program-card.hidden { display: none; }
        .urgency-badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem; font-weight: 600; }
        .card { background: linear-gradient(135deg, var(--nuview-white) 0%, #fafafa 100%); border: 2px solid rgba(238, 51, 56, 0.15); border-radius: 12px; padding: 1.5rem; box-shadow: 0 3px 10px rgba(238, 51, 56, 0.08), 0 1px 4px rgba(0, 0, 0, 0.04); transition: all 0.3s ease; }
        .card:hover { box-shadow: 0 6px 16px rgba(238, 51, 56, 0.12), 0 2px 6px rgba(0, 0, 0, 0.08); transform: translateY(-2px); }
        .card h3 { color: var(--nuview-red); font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; }
        .card .text-muted { color: var(--nuview-navy) !important; opacity: 0.75; font-weight: 500; font-size: 0.95rem; }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header { padding: 2.5rem 1.5rem 2rem; }
            .header-logo { font-size: 2.5rem; letter-spacing: 1px; margin-bottom: 1rem; }
            .header h1 { font-size: 2rem; margin: 0.5rem 0 0.75rem; }
            .header-subtitle { font-size: 1rem; }
            .sidebar { width: 220px; }
            .main-content { margin-left: 220px; padding: 20px; }
            .section h2 { font-size: 1.5rem; }
            .card h3 { font-size: 2rem; }
        }
        
        @media (max-width: 576px) {
            .header { padding: 2rem 1rem 1.5rem; }
            .header-logo { font-size: 2rem; }
            .header h1 { font-size: 1.5rem; }
            .header-subtitle { font-size: 0.9rem; }
            .sidebar { position: relative; width: 100%; height: auto; border-right: none; border-bottom: 3px solid var(--nuview-red); }
            .main-content { margin-left: 0; padding: 15px; }
        }
        .urgency-urgent { background: var(--nuview-red); color: white; }
        .urgency-near { background: #ffc107; color: #333; }
        .urgency-future { background: #28a745; color: white; }
    </style>
</head>
<body>

<nav class="sidebar" role="navigation" aria-label="Main navigation">
    <h3>NUVIEW INTEL</h3>
    <a href="#overview" class="active" aria-current="page"><i class="bi bi-house-door" aria-hidden="true"></i> Overview</a>
    <a href="#funding"><i class="bi bi-currency-dollar" aria-hidden="true"></i> Funding</a>
    <a href="#lidar"><i class="bi bi-radar" aria-hidden="true"></i> LiDAR</a>
    <a href="#space-systems"><i class="bi bi-rocket-takeoff" aria-hidden="true"></i> Space Systems</a>
    <a href="#platform"><i class="bi bi-server" aria-hidden="true"></i> Platform</a>
    <a href="pipeline.html"><i class="bi bi-funnel" aria-hidden="true"></i> Pipeline Dashboard</a>
</nav>

<main class="main-content" role="main">
    <header class="header" role="banner">
        <div class="header-content">
            <div class="header-logo" aria-label="NUVIEW logo">NUVIEW</div>
            <h1>Global LiDAR Intelligence Tracker</h1>
            <p class="header-subtitle">Strategic Pipeline Dashboard â€¢ 2025â€“2027 â€¢ DaaS Disruption</p>
        </div>
    </header>

    <!-- Global Search -->
    <div class="search-container">
        <input 
            type="text" 
            id="globalSearch" 
            class="search-input" 
            placeholder="ðŸ” Search programs by title, agency, category, or action..."
        >
    </div>

    <div id="overview" class="section">
        <h2><i class="bi bi-house-door"></i> Executive Overview</h2>
        <p>The global LiDAR market is projected to reach <strong id="market-val">$14.13B</strong> by 2034 (CAGR <span id="market-cagr">19.43%</span>). NUVIEW dominates DaaS with space-based data.</p>
        <div class="row">
            <div class="col-md-3">
                <div class="card text-center">
                    <h3 id="total-programs">0</h3>
                    <p class="text-muted">Total Programs</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <h3 id="total-value">$0</h3>
                    <p class="text-muted">Total Value</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <h3 id="urgent-programs">0</h3>
                    <p class="text-muted">Urgent Actions</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <h3 id="last-updated">Loading...</h3>
                    <p class="text-muted">Last Updated</p>
                </div>
            </div>
        </div>
    </div>

    <div id="funding" class="section">
        <h2><i class="bi bi-currency-dollar"></i> Funding Opportunities</h2>
        <div id="funding-programs">
            <p>Loading funding programs...</p>
        </div>
    </div>

    <div id="lidar" class="section">
        <h2><i class="bi bi-radar"></i> LiDAR Programs</h2>
        <div id="lidar-programs">
            <p>Loading LiDAR programs...</p>
        </div>
    </div>

    <div id="space-systems" class="section">
        <h2><i class="bi bi-rocket-takeoff"></i> Space Systems</h2>
        <div id="space-systems-programs">
            <p>Loading space systems programs...</p>
        </div>
    </div>

    <div id="platform" class="section">
        <h2><i class="bi bi-server"></i> Platform Initiatives</h2>
        <div id="platform-programs">
            <p>Loading platform programs...</p>
        </div>
    </div>
</main>

<script>
// Global data
let programsData = null;

// Format currency
function formatCurrency(amount) {
    if (!amount) return '$0';
    if (amount >= 1000000000) {
        return '$' + (amount / 1000000000).toFixed(2) + 'B';
    } else if (amount >= 1000000) {
        return '$' + (amount / 1000000).toFixed(1) + 'M';
    } else if (amount >= 1000) {
        return '$' + (amount / 1000).toFixed(0) + 'K';
    }
    return '$' + amount.toFixed(0);
}

// Get urgency badge
function getUrgencyBadge(urgency) {
    const badges = {
        'urgent': '<span class="urgency-badge urgency-urgent">URGENT</span>',
        'near': '<span class="urgency-badge urgency-near">NEAR</span>',
        'future': '<span class="urgency-badge urgency-future">FUTURE</span>'
    };
    return badges[urgency || 'future'] || badges['future'];
}

// Create program card
function createProgramCard(program) {
    const card = document.createElement('div');
    card.className = 'program-card';
    card.setAttribute('data-searchable', `${program.title || ''} ${program.agency || ''} ${program.category || ''} ${program.nextAction || ''}`.toLowerCase());
    
    const title = program.title || 'Untitled Program';
    const agency = program.agency || 'N/A';
    const value = formatCurrency(program.valueUSD || 0);
    const deadline = program.deadline || 'TBD';
    const daysUntil = program.daysUntil !== undefined ? program.daysUntil : 'N/A';
    const urgency = program.urgency || 'future';
    const nextAction = program.nextAction || 'No action specified';
    const description = program.description || 'No description available';
    const link = program.link || '#';
    
    card.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
            <div>
                <h5 style="margin: 0; color: var(--nuview-navy);">${title}</h5>
                <p style="margin: 0.25rem 0; color: #666; font-size: 0.9rem;">${description}</p>
            </div>
            ${getUrgencyBadge(urgency)}
        </div>
        <div class="row" style="margin-top: 1rem; font-size: 0.9rem;">
            <div class="col-md-3">
                <strong>Agency:</strong> ${agency}
            </div>
            <div class="col-md-3">
                <strong>Value:</strong> ${value}
            </div>
            <div class="col-md-3">
                <strong>Deadline:</strong> ${deadline} (${daysUntil} days)
            </div>
            <div class="col-md-3">
                <strong>Link:</strong> <a href="${link}" target="_blank" style="color: var(--nuview-red); font-weight: 600;">View</a>
            </div>
        </div>
        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #eee;">
            <strong style="color: var(--nuview-red);">Next Action:</strong> ${nextAction}
        </div>
    `;
    
    return card;
}

// Render programs in a section
function renderPrograms(programs, containerId) {
    const container = document.getElementById(containerId);
    if (!container) return;
    
    container.innerHTML = '';
    
    if (!programs || programs.length === 0) {
        container.innerHTML = '<p style="color: #999;">No programs in this category.</p>';
        return;
    }
    
    programs.forEach(program => {
        container.appendChild(createProgramCard(program));
    });
}

// Update overview statistics
function updateOverview() {
    if (!programsData || !programsData.programs) return;
    
    const allPrograms = [
        ...(programsData.programs.funding || []),
        ...(programsData.programs.lidar || []),
        ...(programsData.programs.spaceSystems || []),
        ...(programsData.programs.platform || [])
    ];
    
    // Remove duplicates by ID
    const uniquePrograms = Array.from(new Map(allPrograms.map(p => [p.id, p])).values());
    
    const totalValue = uniquePrograms.reduce((sum, p) => sum + (p.valueUSD || 0), 0);
    const urgentCount = uniquePrograms.filter(p => p.urgency === 'urgent').length;
    
    document.getElementById('total-programs').textContent = uniquePrograms.length;
    document.getElementById('total-value').textContent = formatCurrency(totalValue);
    document.getElementById('urgent-programs').textContent = urgentCount;
    
    if (programsData.meta && programsData.meta.updated) {
        const date = new Date(programsData.meta.updated);
        document.getElementById('last-updated').textContent = date.toLocaleDateString();
    }
}

// Global search functionality - FIX: use e.target.value instead of this.value
function setupGlobalSearch() {
    const searchInput = document.getElementById('globalSearch');
    if (!searchInput) return;
    
    searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase(); // FIXED: use e.target.value
        const allCards = document.querySelectorAll('.program-card');
        
        allCards.forEach(card => {
            const searchableText = card.getAttribute('data-searchable') || '';
            if (searchableText.includes(searchTerm)) {
                card.classList.remove('hidden');
            } else {
                card.classList.add('hidden');
            }
        });
    });
}

// Load programs data
async function loadPrograms() {
    try {
        const response = await fetch('../data/processed/programs.json');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        programsData = await response.json();
        
        // Render all sections with robust handling for missing data
        renderPrograms(programsData.programs?.funding || [], 'funding-programs');
        renderPrograms(programsData.programs?.lidar || [], 'lidar-programs');
        renderPrograms(programsData.programs?.spaceSystems || [], 'space-systems-programs');
        renderPrograms(programsData.programs?.platform || [], 'platform-programs');
        
        // Update overview
        updateOverview();
        
        // Setup global search
        setupGlobalSearch();
        
    } catch (error) {
        console.error('Error loading programs data:', error);
        const containers = ['funding-programs', 'lidar-programs', 'space-systems-programs', 'platform-programs'];
        containers.forEach(id => {
            const container = document.getElementById(id);
            if (container) {
                container.innerHTML = '<p style="color: var(--nuview-red);">Error loading data. Please check the console for details.</p>';
            }
        });
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    loadPrograms();
});
</script>
</body>
</html>
